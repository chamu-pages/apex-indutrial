<!DOCTYPE html>
<html lang="en" class="bg-zinc-950 text-white">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Company Support Chat</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>tailwind.config = { content: ["*"] }</script>
</head>

<body class="min-h-screen flex flex-col">
    <div class="max-w-3xl mx-auto w-full flex-1 flex flex-col p-4">
        <h1 class="text-3xl font-bold text-center mb-6 text-emerald-400">
            My Company Support <span class="text-xs bg-zinc-800 px-2 py-1 rounded">openai-fast • no key</span>
        </h1>

        <div id="chat" class="flex-1 overflow-y-auto space-y-6 mb-6 pr-2"></div>

        <div class="flex gap-3">
            <input id="input" type="text"
                class="flex-1 bg-zinc-900 border border-zinc-700 rounded-2xl px-6 py-4 focus:outline-none focus:border-emerald-500"
                placeholder="Ask anything... (e.g. refund, tracking, product info)">
            <button id="send" class="bg-emerald-600 hover:bg-emerald-500 px-8 rounded-2xl font-medium transition">
                Send
            </button>
        </div>
    </div>

    <script>
        const chat = document.getElementById('chat');
        const input = document.getElementById('input');
        const sendBtn = document.getElementById('send');

        // ==================== YOUR CUSTOMER SUPPORT DATA HERE ====================
        let messages = [
            {
                role: "system",
                content: `You are a friendly, professional customer support agent for MY COMPANY.
        
        Company name: My Awesome Store
        Website: myawesomestore.com
        Products: T-shirts, hoodies, mugs, phone cases
        Shipping: Free over $50, 3-7 business days worldwide
        Return policy: 30 days, no questions asked
        Contact: support@myawesomestore.com
        
        Tone: Helpful, polite, concise, slightly fun.
        Never give fake tracking numbers.
        If you don't know something, say "I'll check that for you" and offer to escalate.
        
        FAQ examples:
        - Refund: processed in 3-5 business days after return received
        - Tracking: check your email or "order status" in account
        - Size chart: link to size chart page`
            }
        ];
        // =====================================================================

        function addMessage(role, content) {
            const div = document.createElement('div');
            div.className = `flex ${role === 'user' ? 'justify-end' : 'justify-start'}`;
            div.innerHTML = `
        <div class="chat-bubble px-5 py-3 rounded-3xl ${role === 'user' ? 'bg-emerald-600' : 'bg-zinc-800'}">
          ${content}
        </div>
      `;
            chat.appendChild(div);
            chat.scrollTop = chat.scrollHeight;
        }

        async function sendMessage() {
            const text = input.value.trim();
            if (!text) return;

            addMessage('user', text);
            messages.push({ role: "user", content: text });
            input.value = '';

            const assistantDiv = document.createElement('div');
            assistantDiv.className = 'flex justify-start';
            assistantDiv.innerHTML = `
        <div class="chat-bubble px-5 py-3 rounded-3xl bg-zinc-800">
          <span id="streaming-text" class="inline-block"></span>
        </div>
      `;
            chat.appendChild(assistantDiv);
            chat.scrollTop = chat.scrollHeight;
            const streamingText = assistantDiv.querySelector('#streaming-text');

            try {
                const res = await fetch('https://text.pollinations.ai/openai', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        model: "openai-fast",
                        messages: messages,   // ← full history + system prompt
                        stream: true
                    })
                });

                const reader = res.body.getReader();
                const decoder = new TextDecoder();
                let buffer = '';

                while (true) {
                    const { done, value } = await reader.read();
                    if (done) break;
                    buffer += decoder.decode(value, { stream: true });
                    const lines = buffer.split('\n');
                    buffer = lines.pop();

                    for (const line of lines) {
                        if (line.startsWith('data: ')) {
                            const data = line.slice(6);
                            if (data === '[DONE]') continue;
                            try {
                                const parsed = JSON.parse(data);
                                const chunk = parsed.choices[0]?.delta?.content || '';
                                if (chunk) {
                                    streamingText.textContent += chunk;
                                    chat.scrollTop = chat.scrollHeight;
                                }
                            } catch (e) { }
                        }
                    }
                }

                // Save final assistant message
                messages.push({ role: "assistant", content: streamingText.textContent });

            } catch (err) {
                streamingText.textContent = "Sorry, connection error. Please try again.";
                console.error(err);
            }
        }

        sendBtn.addEventListener('click', sendMessage);
        input.addEventListener('keypress', e => { if (e.key === 'Enter') sendMessage(); });

        // Welcome message
        setTimeout(() => {
            addMessage('assistant', "Hi! I'm here to help with orders, shipping, returns, or any questions about My Awesome Store. What can I assist you with today?");
        }, 300);
    </script>
</body>

</html>